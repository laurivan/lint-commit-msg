#!/usr/bin/env bash

. "${TEST_FILE_DIR}/common"

before_all() {
    export LCM_COLOR=never
}

test_verb_present_participle() {
    cat > msg.txt <<EOF
Updating CI pipelines
EOF
    call lint-commit-msg msg.txt
    expect_linting_error
    stdout_contains "- line 1: verb 'Updating' in the subject not in imperative mood,"
    stdout_contains "use for example 'Add' instead of 'Adding'"
    # stdout_contains_regex "^  LCM_IGNORE_SUBJECT_MOOD$"
}

test_verb_past_tense() {
    cat > msg.txt <<EOF
Updated CI pipelines
EOF
    call lint-commit-msg msg.txt
    expect_linting_error
    stdout_contains "- line 1: verb 'Updated' in the subject not in imperative mood,"
    stdout_contains "use for example 'Add' instead of 'Added'"
    # stdout_contains_regex "^  LCM_IGNORE_SUBJECT_MOOD$"
}

test_verb_third_person_present() {
    cat > msg.txt <<EOF
Updates CI pipelines
EOF
    call lint-commit-msg msg.txt
    expect_linting_error
    stdout_contains "- line 1: verb 'Updates' in the subject not in imperative mood,"
    stdout_contains "use for example 'Add' instead of 'Adds'"
    # stdout_contains_regex "^  LCM_IGNORE_SUBJECT_MOOD$"
}

test_irregular_verb() {
    cat > msg.txt <<EOF
Wrote API documentation
EOF
    call lint-commit-msg msg.txt
    expect_linting_error
    stdout_contains "- line 1: verb 'Wrote' in the subject not in imperative mood,"
    stdout_contains "use for example 'Add' instead of 'Added'"
    # stdout_contains_regex "^  LCM_IGNORE_SUBJECT_MOOD$"
}

test_ignore_verb() {
    cat > msg.txt <<EOF
Updated CI pipelines
EOF
    export LCM_IGNORE_SUBJECT_MOOD=true
    call lint-commit-msg msg.txt
    expect_success
}
